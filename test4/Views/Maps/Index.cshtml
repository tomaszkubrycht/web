@page

@{

}


<div id="maps" style="width:100%;height:600px;margin:0 auto;padding:0;">
  

</div>
@section Scripts {
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.8.0/dist/leaflet.css" integrity="sha512-hoalWLoI8r4UszCkZ5kL8vayOGVae1oxXe/2A4AO6J9+580uKHDO3JdHb7NzwwzK5xr/Fs0W40kiNHxM9vyTtQ==" crossorigin="" />
    <script src="https://unpkg.com/leaflet@1.8.0/dist/leaflet.js" integrity="sha512-BB3hKbKWOc9Ez/TAwyWxNXeoV9c1v6FIeYiBieIWkpLjauysF18NzgR1MBNBXf8/KABdlkX68nAhlwcDFLGPCQ==" crossorigin=""></script>
<script>
    var map = L.map('maps').setView([50.44979327773809, 19.517263995788852], 15);
    var tom= L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
        maxZoom: 19,
        attribution: '© OpenStreetMap'
    }).addTo(map);

   

    var punkty =L.tileLayer.wms('https://www.kubrycht.com/geoserver/postgis/wms?', {
        layers: 'Punkt',
        format: 'image/png',
        transparent: true,
        version: '1.1.0',
        attribution: "myattribution"
    });
    
    var rurociag = L.tileLayer.wms('https://www.kubrycht.com/geoserver/postgis/wms?', {
        layers: 'siecwod',
        format: 'image/png',
        transparent: true,
        version: '1.1.0',
        attribution: "myattribution"
    });
    var rurociag_podzamcze = L.tileLayer.wms('https://www.kubrycht.com/geoserver/postgis/wms?', {
        layers: 'siecwod_podzamcze',
        format: 'image/png',
        transparent: true,
        version: '1.1.0',
        attribution: "myattribution"
    });

    var dzialki = L.tileLayer.wms('https://www.kubrycht.com/geoserver/postgis/wms?', {
        layers: 'dzialki',
        format: 'image/png',
        transparent: true,
        version: '1.1.0',
        attribution: "myattribution"
    });
    var budynki = L.tileLayer.wms('https://www.kubrycht.com/geoserver/postgis/wms?', {
        layers: 'budynki',
        format: 'image/png',
        transparent: true,
        version: '1.1.0',
        attribution: "myattribution"
    });
    var numery = L.tileLayer.wms('https://www.kubrycht.com/geoserver/postgis/wms?', {
        layers: 'numery_dzialek',
        format: 'image/png',
        transparent: true,
        version: '1.1.0',
        attribution: "myattribution"
    });
    var baseMaps = {
        
    }
    var owsrootUrl = 'https://www.kubrycht.com/geoserver/postgis/ows';

    var defaultParameters = {
        service: 'WFS',
        version: '1.0.0',
        request: 'GetFeature',
        typeName: 'postgis:siecwod',
        outputFormat: 'application/json',

    };

    function overlap(rect1, rect2) {
        return (!(rect1.right < rect2.left ||
            rect1.left > rect2.right ||
            rect1.bottom < rect2.top ||
            rect1.top > rect2.bottom));
    }

    function hideOverlappingTooltips() {
        var rects = [];
        var tooltips = document.getElementsByClassName('myTooltip');
        for (var i = 0; i < tooltips.length; i++) {
            tooltips[i].style.visibility = '';
            rects[i] = tooltips[i].getBoundingClientRect();
        }
        for (var i = 0; i < tooltips.length; i++) {
            if (tooltips[i].style.visibility != 'hidden') {
                for (var j = i + 1; j < tooltips.length; j++) {
                    if (overlap(rects[i], rects[j])) tooltips[j].style.visibility = 'hidden';
                }
            }
        }
    }
    
    var parameters = L.Util.extend(defaultParameters);

    var URL = owsrootUrl + L.Util.getParamString(parameters);

    $.ajax({
        url: URL,
        success: function (data) {
            var geojson = new L.geoJson(data, {
                style: { "color": "blue", "weight": 3 },
                onEachFeature: function (feature, layer) {
                    layer.bindTooltip("srednica: " + feature.properties.srednica, { permanent: true, opacity: 0.7, className: 'myTooltip' }).openTooltip();
                }
            }
            ).addTo(map);
        }
    });
   
    hideOverlappingTooltips();
   
    map.on('zoomend', function (evt) {
        hideOverlappingTooltips();
    });
    
    var overlays = {

        "Połaczenia": punkty,
        "Siec Wodociagowa": rurociag,
        "Siec Podzamcze": rurociag_podzamcze,
        "dzialki": dzialki,
        "Budynki": budynki,
        "numery działek": numery
       
    }
    var layerControl = L.control.layers(baseMaps, overlays).addTo(map);
    

    </script>
 @{await Html.RenderPartialAsync("_ValidationScriptsPartial");}
}
